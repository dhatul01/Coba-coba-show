<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show Manager Realtime48 - Persistence Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 tracking-tight">Show Manager Realtime</h1>
            <p class="text-gray-600">Link yang disalin akan terhapus otomatis secara permanen</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- LEFT COLUMN: INPUT/FORM -->
            <div class="space-y-6">
                <div id="manualSection" class="glass-card rounded-2xl p-6 shadow-xl border border-blue-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Form Jadwal</h3>
                        <div class="flex flex-col items-end">
                            <span id="linkCounter" class="text-xs font-bold bg-blue-100 text-blue-600 px-3 py-1 rounded-full">
                                Sisa Link: 0
                            </span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Nama Show -->
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nama Show</label>
                            <select id="inShow" onchange="handleIdentifierChange()" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white">
                                <option value="">-- Pilih Show --</option>
                                <option value="Cara Meminum Ramune">Cara Meminum Ramune</option>
                                <option value="Sambil Menggandeng Erat Tanganku">Sambil Menggandeng Erat Tanganku</option>
                                <option value="Pertaruhan Cinta">Pertaruhan Cinta</option>
                                <option value="Pajama Drive">Pajama Drive</option>
                            </select>
                        </div>
                        
                        <!-- Tanggal & Jam -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Pilih Tanggal</label>
                                <input type="date" id="inDate" onchange="handleIdentifierChange()" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Jam</label>
                                <input type="text" id="inTime" oninput="updatePreview()" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="16.00 WIB">
                            </div>
                        </div>

                        <!-- Link Utama (Switch Manual/Auto) -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="block text-xs font-bold text-gray-500 uppercase">Link Utama</label>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] font-bold text-gray-400">AUTO</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="linkModeToggle" onchange="toggleLinkMode()" class="sr-only peer">
                                        <div class="w-8 h-4 bg-blue-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                    <span class="text-[10px] font-bold text-gray-400">MANUAL</span>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <input type="text" id="inMain" oninput="updatePreview()" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none disabled:bg-gray-50 disabled:text-gray-400" placeholder="Masukkan link utama...">
                                <button id="btnNextLink" onclick="useNextLink()" class="bg-gray-100 hover:bg-gray-200 p-3 rounded-lg border border-gray-200 transition-colors" title="Lewati ke Link Berikutnya">
                                    üîÑ
                                </button>
                            </div>
                            <p id="idInfo" class="text-[9px] text-blue-500 mt-1 font-mono uppercase italic"></p>
                        </div>

                        <!-- Sandi Replay -->
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Sandi Replay</label>
                            <input type="text" id="inPass" oninput="updatePreview()" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="8Ramun3">
                        </div>

                        <div class="pt-4 border-t border-gray-100 flex justify-between">
                            <button onclick="hardResetDatabase()" class="text-xs text-red-500 hover:underline">Restore Semua Link Original</button>
                            <p class="text-[10px] text-gray-400 font-bold">MODE: PERSISTENT STORAGE ACTIVE</p>
                        </div>
                    </div>
                </div>

                <!-- Link Database Info -->
                <div class="glass-card rounded-2xl p-6 shadow-md border border-gray-100">
                    <h3 class="text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                        üìã Antrian Link Tersedia (Local Storage)
                    </h3>
                    <div id="linkDatabaseView" class="text-[10px] font-mono text-gray-500 max-h-40 overflow-y-auto space-y-1">
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: PREVIEW & RESULT -->
            <div class="space-y-6">
                <div class="glass-card rounded-2xl p-6 shadow-xl border-t-4 border-blue-600 sticky top-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">Preview Pesan</h3>
                        <button 
                            onclick="copyAndConsume()"
                            id="copyBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H5a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Salin & Hapus Link
                        </button>
                    </div>
                    
                    <div id="formattedOutput" class="bg-gray-50 p-4 rounded-xl border border-gray-200 text-sm whitespace-pre-wrap font-sans leading-relaxed text-gray-700 overflow-y-auto max-h-[500px]">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-black text-white px-8 py-3 rounded-full text-sm font-bold opacity-0 transition-opacity pointer-events-none z-50 shadow-2xl">
        Berhasil disalin & Link dihapus permanen!
    </div>

    <script>
        // Data awal (Original) yang akan di-load jika storage kosong
        const initialLinks = {
            "Sambil Menggandeng Erat Tanganku|2026-02-12": [
                "https://play.realtime48s.my.id/#dESIHmCyA6l5Z9k7ZGtP",
                "https://play.realtime48s.my.id/#K4tlp9smPQSgpcPlMRzR",
                "https://play.realtime48s.my.id/#fnT3tMHkJYUYXnauVDEP",
                "https://play.realtime48s.my.id/#4AU2Xa8j3mdbBmEDZTup",
                "https://play.realtime48s.my.id/#dNvIIZHc0EBkbkue8LAv",
                "https://play.realtime48s.my.id/#zlcfm8s8iYMDiFg4Kpyo",
                "https://play.realtime48s.my.id/#ZYqgK8khxT3lUktLBNcV",
                "https://play.realtime48s.my.id/#vhWM7wJriATYOEtx9sM6",
                "https://play.realtime48s.my.id/#tyLqrDcaZ9fXLHjh9GFF",
                "https://play.realtime48s.my.id/#XCAlVcrBJq8Jany2aqHj"
            ],
            "Pertaruhan Cinta|2026-02-15": [
                "https://play.realtime48s.my.id/#oDEl5TzFA5BP42J0emaT",
                "https://play.realtime48s.my.id/#YGzpmvW4WEf7l5jXmnOt",
                "https://play.realtime48s.my.id/#y2F3TNjSPyLCrvA62cgL",
                "https://play.realtime48s.my.id/#EQuFujeG590fIRS9BKC1",
                "https://play.realtime48s.my.id/#9E3X4sUUZDdNv4k5Dp8Q",
                "https://play.realtime48s.my.id/#9PbBaIZxE1A5SmVDuDVF",
                "https://play.realtime48s.my.id/#McXEjAl1LxsIRE1GD73d",
                "https://play.realtime48s.my.id/#15B2N4V9PBNEY6R3VEcS",
                "https://play.realtime48s.my.id/#Riv3rBqfqhsB1kKeOfh9",
                "https://play.realtime48s.my.id/#nZ7TSyB4ipCrxRGPpa08",
                "https://play.realtime48s.my.id/#W71P2EpTr6eNS5NtaO0I",
                "https://play.realtime48s.my.id/#SVuwybtp58GE7pox2i0w",
                "https://play.realtime48s.my.id/#gLXiyy1XN0OG9rfvF6vK",
                "https://play.realtime48s.my.id/#YpHqLsrfRP7XecyG3Szu"
            ],
            "Pertaruhan Cinta|2026-02-13": [
                "https://play.realtime48s.my.id/#hUEx93EqAOPHVDYY80tR",
                "https://play.realtime48s.my.id/#xoSRBVyUiUz1CquXMfb8",
                "https://play.realtime48s.my.id/#BJxuzlCBAFabkckVfDCl",
                "https://play.realtime48s.my.id/#opFpLac0Z4hpLInRZMy0",
                "https://play.realtime48s.my.id/#nJcw1odAzGX8e0YV2eyc",
                "https://play.realtime48s.my.id/#OPPV6EipaoH5g85crnVW",
                "https://play.realtime48s.my.id/#CfC2yyJA09OwWgmc3mBD",
                "https://play.realtime48s.my.id/#ED8eNVg7cgqKYwdZzhaK",
                "https://play.realtime48s.my.id/#H9yHaL5sgvU9XZUP0MOn",
                "https://play.realtime48s.my.id/#KmKLLHvS7v71G46behV7",
                "https://play.realtime48s.my.id/#Kh7aVU59sWQPNVHRLFFF",
                "https://play.realtime48s.my.id/#AQaDEP0BEd03l6pL6QrD",
                "https://play.realtime48s.my.id/#HulUBgqAWHnYh0FgGonD",
                "https://play.realtime48s.my.id/#0mEIAWzP4STwZBCAWeZi",
                "https://play.realtime48s.my.id/#93HuLQtgptHnf97gk5zq"
            ],
            "Sambil Menggandeng Erat Tanganku|2026-02-14": [
                "https://play.realtime48s.my.id/#T6VMrSuBCWqajeuH6IHj",
                "https://play.realtime48s.my.id/#uYQerXD9PyPDtylby9qx",
                "https://play.realtime48s.my.id/#4Kms4NIvLRHuuM8Wtq62",
                "https://play.realtime48s.my.id/#FaLepyMJZGOGrlx7qUl0",
                "https://play.realtime48s.my.id/#2NFV78hTSiY0JeE6kGjX",
                "https://play.realtime48s.my.id/#1wbPrWB5kOfYD61ft9sh",
                "https://play.realtime48s.my.id/#GAs7eJv8Q3TF93VA4LPF"
            ],
            "Cara Meminum Ramune|2026-02-16": [
                "https://play.realtime48s.my.id/#iGoLJ2ci8hqzpSxvYc3F",
                "https://play.realtime48s.my.id/#vtseMW1ubyDT5dOeOIBS",
                "https://play.realtime48s.my.id/#A1tLJDartBManhCbJDEE",
                "https://play.realtime48s.my.id/#7lpMIW6LrFVyPoGygsWE",
                "https://play.realtime48s.my.id/#FyrkgWXXQnrXffhr3Qe4",
                "https://play.realtime48s.my.id/#9g1BeZZt1ExAgerXPAp7",
                "https://play.realtime48s.my.id/#DZjIZKxzdt5HtWd9mYF0",
                "https://play.realtime48s.my.id/#N7iLz7KKxnSxbNTLBH6C",
                "https://play.realtime48s.my.id/#zX8tVgHWn3wI8c0aDbL4",
                "https://play.realtime48s.my.id/#BJ0clwg9ErNeqseISJyU",
                "https://play.realtime48s.my.id/#UfzgiYpZ2xwyypg0umtz",
                "https://play.realtime48s.my.id/#CDjygYuKHAoLpDu33gTq",
                "https://play.realtime48s.my.id/#7puIizyNXw0T5w21uE3R",
                "https://play.realtime48s.my.id/#vF6pBu0L2WIUgSqNVB5H",
                "https://play.realtime48s.my.id/#bWM9WdWZZ90Uur493cHB",
                "https://play.realtime48s.my.id/#0tcdlZk4LWVLgoRkvHDk"
            ]
        };

        const STORAGE_KEY = "show_manager_links_db";
        const REPLAY_BASE_URL = "https://48realtime.github.io/Replay-Show/";
        
        let linkDatabase = {};
        let activeLink = "";
        let isManualMode = false;

        // FUNGSI UTAMA: Load dari LocalStorage atau Gunakan Data Awal
        function initDatabase() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                linkDatabase = JSON.parse(savedData);
            } else {
                linkDatabase = JSON.parse(JSON.stringify(initialLinks));
                saveToStorage();
            }
        }

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(linkDatabase));
        }

        function hardResetDatabase() {
            if (confirm("PERINGATAN: Ini akan mengembalikan semua link yang sudah terhapus. Lanjutkan?")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function toggleLinkMode() {
            isManualMode = document.getElementById('linkModeToggle').checked;
            const inputMain = document.getElementById('inMain');
            const btnNext = document.getElementById('btnNextLink');
            const copyBtnText = document.getElementById('copyBtn');
            
            if (isManualMode) {
                inputMain.disabled = false;
                inputMain.classList.remove('bg-gray-50', 'text-gray-400');
                inputMain.classList.add('bg-white', 'text-gray-800');
                btnNext.disabled = true;
                btnNext.classList.add('opacity-50');
                copyBtnText.innerHTML = 'Salin Format (Manual)';
            } else {
                inputMain.disabled = true;
                inputMain.classList.add('bg-gray-50', 'text-gray-400');
                inputMain.classList.remove('bg-white', 'text-gray-800');
                btnNext.disabled = false;
                btnNext.classList.remove('opacity-50');
                copyBtnText.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H5a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                    Salin & Hapus Link`;
                handleIdentifierChange();
            }
            updatePreview();
        }

        function handleIdentifierChange() {
            if (isManualMode) {
                updatePreview();
                return;
            }

            const show = document.getElementById('inShow').value;
            const date = document.getElementById('inDate').value;
            const idInfo = document.getElementById('idInfo');
            
            if (show && date) {
                const key = `${show}|${date}`;
                idInfo.innerText = `ID: ${key}`;
                
                const links = linkDatabase[key] || [];
                if (links.length > 0) {
                    activeLink = links[0];
                    document.getElementById('inMain').value = activeLink;
                } else {
                    activeLink = "";
                    document.getElementById('inMain').value = "";
                }
            } else {
                idInfo.innerText = "";
                activeLink = "";
                document.getElementById('inMain').value = "";
            }
            
            renderDatabaseView();
            updatePreview();
        }

        function useNextLink() {
            if (isManualMode) return;
            const show = document.getElementById('inShow').value;
            const date = document.getElementById('inDate').value;
            const key = `${show}|${date}`;
            
            // Lewati link (pindah ke belakang antrian)
            if (linkDatabase[key] && linkDatabase[key].length > 1) {
                const skipped = linkDatabase[key].shift();
                linkDatabase[key].push(skipped);
                saveToStorage();
                handleIdentifierChange();
            }
        }

        function renderDatabaseView() {
            const view = document.getElementById('linkDatabaseView');
            const counter = document.getElementById('linkCounter');
            const show = document.getElementById('inShow').value;
            const date = document.getElementById('inDate').value;
            
            view.innerHTML = "";
            
            if (!show || !date) {
                view.innerHTML = "Pilih Show & Tanggal untuk melihat sisa link.";
                counter.innerText = "Sisa Link: 0";
                return;
            }

            const key = `${show}|${date}`;
            const links = linkDatabase[key] || [];
            counter.innerText = `Sisa Link: ${links.length}`;

            if (links.length === 0) {
                view.innerHTML = "<span class='text-red-500 font-bold'>‚ö†Ô∏è LINK HABIS! Silakan tambah di database atau gunakan mode manual.</span>";
                return;
            }

            links.forEach((link, index) => {
                const div = document.createElement('div');
                div.className = `p-1 truncate border-b border-gray-50 ${index === 0 ? 'text-blue-600 font-bold bg-blue-50' : 'text-gray-400'}`;
                div.innerText = `${index + 1}. ${link}`;
                view.appendChild(div);
            });
        }

        function formatIndoDate(dateStr) {
            if (!dateStr) return null;
            const dateObj = new Date(dateStr);
            if (isNaN(dateObj.getTime())) return null;
            const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            return `${String(dateObj.getDate()).padStart(2, '0')} ${months[dateObj.getMonth()]} ${dateObj.getFullYear()}`;
        }

        function updatePreview() {
            const show = document.getElementById('inShow').value || "[NAMA SHOW]";
            const rawDate = document.getElementById('inDate').value;
            const formattedDate = formatIndoDate(rawDate) || "[TANGGAL]";
            const time = document.getElementById('inTime').value || "[JAM]";
            
            const mainLink = isManualMode ? document.getElementById('inMain').value : (activeLink || "[LINK UTAMA]");
            const pass = document.getElementById('inPass').value || "[SANDI]";

            const template = `> *Show : ${show}*
> *Akses tanggal : ${formattedDate} jam : ${time}*

üì¢ *AKSES LIVE STREAMING pada LINK UTAMA Dan REPLAY* : 

1Ô∏è‚É£ Link Utama: üîó ${mainLink}

üîóReplay ${formattedDate} : ${REPLAY_BASE_URL}
üóùÔ∏è Sandi : ${pass}

üìß*Cara akses Live Chat* :
  Hapus cache pada browser yang akan digunakan untuk menonton live.... 

‚ö†Ô∏è *PENTING UNTUK DIPERHATIKAN*:
1 Akun = 1 Device/browser : Jangan login di dua perangkat bersamaan.
Waktu Akses: Disarankan masuk website saat live sudah dimulai (Cek info terbaru di saluran).
Browser: Gunakan Chrome atau Opera untuk pengalaman terbaik.
Kendala Akses: Jika tombol masuk tidak berfungsi, mohon matikan AdBlock/DNS AdGuard.

Jika ada kendala, segera hubungi Admin. Selamat menonton! ‚ú®`;

            document.getElementById('formattedOutput').innerText = template;
        }

        function copyAndConsume() {
            const show = document.getElementById('inShow').value;
            const date = document.getElementById('inDate').value;
            const key = `${show}|${date}`;
            const text = document.getElementById('formattedOutput').innerText;
            
            const currentLink = isManualMode ? document.getElementById('inMain').value : activeLink;
            if (!currentLink || currentLink.includes("[")) {
                alert("Mohon lengkapi data dan pastikan link tersedia!");
                return;
            }

            // Copy Action
            const dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = text;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);

            // LOGIKA HAPUS PERMANEN (Hanya jika mode AUTO)
            if (!isManualMode && linkDatabase[key]) {
                // Hapus item pertama (link yang baru saja disalin)
                linkDatabase[key].shift();
                
                // Simpan perubahan ke LocalStorage secara permanen
                saveToStorage();
                
                // Refresh UI
                handleIdentifierChange();
                showToast("Link dihapus dari database!");
            } else {
                showToast("Berhasil disalin!");
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            if(msg) toast.innerText = msg;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        window.onload = () => {
            initDatabase(); // Load data dari storage
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inDate').value = today;
            toggleLinkMode(); 
            handleIdentifierChange();
        };
    </script>
</body>
</html>